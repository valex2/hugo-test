{{ define "main" }}
<article class="container py-5 page-with-sticky-header">
  <header class="mb-3">
    <h1 class="mb-1">{{ .Title }}</h1>

    {{- $root := . -}}  {{/* root context for safe Params access inside nested blocks */}}

    {{/* ---- Date range (uses params.start/end if set; falls back to .Date) ---- */}}
    {{ $startTime := $root.Date }}
    {{ with $root.Params.start }}{{ $startTime = time . }}{{ end }}
    {{ $endRaw := $root.Params.end }}
    {{ $endStr := "Present" }}
    {{ if $endRaw }}
      {{ $endStr = (time $endRaw).Format "Jan 2006" }}
    {{ end }}
    <div class="text-secondary d-flex align-items-center gap-2">
      <small>{{ $startTime.Format "Jan 2006" }} â€“ {{ $endStr }}</small>
      {{- $rt := $root.ReadingTime -}}
      {{- if gt $rt 0 -}}
        <span class="text-secondary" title="{{ $root.WordCount }} words">
          {{ $rt }} {{ $root.Site.Params.singlePages.readTime.content }}
        </span>
      {{- end -}}
    </div>

    {{/* Tag chips (color logic like projects) */}}
    {{ $colors := slice "primary" "secondary" "success" "danger" "warning" "info" }}
    {{ with $root.Params.experience_tags }}
      <div class="pt-2 d-flex flex-wrap gap-1">
        {{ range . }}
          {{ $idx := mod (len .) (len $colors) }}
          <a class="badge bg-{{ index $colors $idx }}" href="/experience_tags/{{ . | urlize }}/">
            {{ . }}
          </a>
        {{ end }}
      </div>
    {{ end }}

    {{/* -------- Link buttons (external, company, website, pdf, custom links) -------- */}}
    {{- $links := slice -}}

    {{- with $root.Params.external -}}
      {{- $links = $links | append (dict "label" "View External" "url" . "icon" "fas fa-external-link-alt") -}}
    {{- end -}}

    {{- with $root.Params.company_url -}}
      {{- $companyLabel := "Company" -}}
      {{- with $root.Params.company -}}{{- $companyLabel = . -}}{{- end -}}
      {{- $links = $links | append (dict "label" $companyLabel "url" . "icon" "fas fa-building") -}}
    {{- end -}}

    {{- with $root.Params.website -}}
      {{- $links = $links | append (dict "label" "Website" "url" . "icon" "fas fa-globe") -}}
    {{- end -}}

    {{- with $root.Params.pdf -}}
      {{- $links = $links | append (dict "label" "PDF" "url" . "icon" "fas fa-file-pdf") -}}
    {{- end -}}

    {{- with $root.Params.links -}}
      {{- range . -}}
        {{- $label := .label | default (.name | default "Link") -}}
        {{- $url   := .url   | default .href -}}
        {{- $icon  := .icon  | default "fas fa-link" -}}
        {{- if $url -}}
          {{- $links = $links | append (dict "label" $label "url" $url "icon" $icon) -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

    {{ if gt (len $links) 0 }}
      <div class="mt-3 d-flex flex-wrap gap-2">
        {{ range $links }}
          <a href="{{ .url }}" class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener">
            {{ with .icon }}<i class="{{ . }} me-1" aria-hidden="true"></i>{{ end }}{{ .label }}
          </a>
        {{ end }}
      </div>
    {{ end }}
    {{/* -------- /Link buttons -------- */}}
  </header>

  <div class="content">
    {{ $root.Content }}
  </div>
</article>

<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/layout-fixes.css">
{{ end }}
