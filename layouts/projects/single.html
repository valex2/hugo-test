{{ define "main" }}
<article class="container py-5 page-with-sticky-header">
  <header class="mb-3">
    <h1 class="mb-1">{{ .Title }}</h1>

    {{- $root := . -}}

    <div class="text-secondary d-flex align-items-center gap-2">
      <small>{{ .Date.Format "Jan 2, 2006" }}</small>
      {{- $rt := .ReadingTime -}}
      {{- if gt $rt 0 -}}
        <span class="text-secondary" title="{{ .WordCount }} words">
          Â· {{ $rt }} {{ .Site.Params.singlePages.readTime.content }}
        </span>
      {{- end -}}
    </div>

    {{/* Project tags */}}
    {{ with .Params.project_tags }}
      {{ partial "tag-system.html" (dict "tags" . "section" "projects" "context" $root) }}
    {{ end }}

    {{/* Project links */}}
    {{- $links := slice -}}
    {{- with .Params.repo -}}
      {{- $links = $links | append (dict "label" "Repository" "url" . "icon" "fab fa-github") -}}
    {{- end -}}
    {{- with .Params.website -}}
      {{- $links = $links | append (dict "label" "Website" "url" . "icon" "fas fa-globe") -}}
    {{- end -}}
    {{- with .Params.demo -}}
      {{- $links = $links | append (dict "label" "Live Demo" "url" . "icon" "fas fa-play-circle") -}}
    {{- end -}}
    {{- with .Params.pdf -}}
      {{- $links = $links | append (dict "label" "PDF" "url" . "icon" "fas fa-file-pdf") -}}
    {{- end -}}
    {{- with .Params.paper -}}
      {{- $links = $links | append (dict "label" "Paper" "url" . "icon" "fas fa-file-alt") -}}
    {{- end -}}
    
    {{/* Custom links */}}
    {{- with .Params.links -}}
      {{- range . -}}
        {{- $label := .label | default (.name | default "Link") -}}
        {{- $url   := .url   | default .href -}}
        {{- $icon  := .icon  | default "fas fa-link" -}}
        {{- if $url -}}
          {{- $links = $links | append (dict "label" $label "url" $url "icon" $icon) -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

    {{ if gt (len $links) 0 }}
      <div class="mt-3 d-flex flex-wrap gap-2">
        {{ range $links }}
          <a href="{{ .url }}" class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener">
            {{ with .icon }}<i class="{{ . }} me-1" aria-hidden="true"></i>{{ end }}{{ .label }}
          </a>
        {{ end }}
      </div>
    {{ end }}
  </header>

  <div class="content">
    {{ $content := .Content | replaceRE "<img([^>]*)>" "<div class='text-center my-4'><img$1 class='img-fluid' style='max-width: 100%; height: auto;'></div>" | safeHTML }}
    {{ $content }}
  </div>
</article>

{{/* Add Disqus comments if enabled */}}
{{ if .Site.DisqusShortname }}
  <div class="container py-4">
    {{ template "_internal/disqus.html" . }}
  </div>
{{ end }}

{{/* Include callout styles */}}
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/layout-fixes.css">
{{ end }}
